FROM diamonds2_base:latest AS base
WORKDIR /app/packages/backend
RUN apt-get update -y && apt-get install -y openssl
COPY --chown=1000:1000 packages/backend .

FROM base AS develop
ENV PORT=3000
# Add Prisma generate here
RUN deno -A npm:prisma generate
EXPOSE $PORT
CMD ["deno", "run", "start:dev"]

FROM base AS prod
ENV PORT=3000
# Add Prisma generate here
RUN deno -A npm:prisma generate
EXPOSE $PORT
CMD ["deno", "run", "start:prod"]
